#!/bin/bash

if [ $# -lt 1 ]; then
    echo "usage: $(basename "$0") input_video [output_video]"
    exit 1
fi

input="$1"
input_noext="${input%.*}"
input_ext="${input##*.}"
output="${2:-"${input_noext}_merged.$input_ext"}"

set -xe;
ffmpeg \
    -i "$input" \
    -filter_complex "[0:a:0][0:a:1]amix=2:longest[aout]" \
    -map 0:V:0 -map "[aout]" \
    -c:v copy -c:a aac \
    -b:a 320k \
    "$output"
